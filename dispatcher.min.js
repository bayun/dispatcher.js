function Dispatcher(){this._cbs={cbs:[],c:{}},this.c=1,this.on=function(a,b,c){if(!b)throw"bad callback";a=a.split(/\s+/);var d,e,f,g,h;while(d=a.shift()){g={cb:b,ct:c,ev:d+":",id:this.c},e=d.split(":"),h=this._cbs;while(f=e.shift())h.cbs.push(g),h=h.c[f]=h.c[f]||{cbs:[],c:{}}}++this.c},this.off=function(a,b,c){var d,e=!0,f,g,h,i;a=a.split(/\s+/);while(e&&(i=a.shift())){d=i.split(":"),i+=":",e=this._cbs;while(g=d.shift()){f=[];while(h=e.cbs.shift())(b&&h.cb!=b||h.ev!=i||h.ct!=c)&&f.push(h);e.cbs=f,d.length?delete e.c[g]:e=e.c[g]}}},this.trigger=function(a){var b,c,d,e,f,g,h,i,j,k;k=a.split(/\s+/),c=arguments,f=[],j={};while(c[0]=b=k.shift()){d=b.split(":"),b+=":",e=this._cbs;while(e&&(h=d.shift())){for(i=0;i<e.cbs.length;++i)g=e.cbs[i],!j[g.id]&&b.lastIndexOf(g.ev,0)===0&&(f.push(g),j[g.id]=1);e=e.c[h]}j=0;for(i=f.length-1;i>=0;--i){g=f[i];if(j&&g.ev.length!=j)break;g.cb.apply(g.ct||this,c)===!1&&(j=g.ev.length)}}}}