function Dispatcher(){this._cbs={cbs:[],c:{}},this.counter=1,this.on=this.bind=function(a,b,c){if(!b)throw"bad callback";a=a.split(/\s+/);var d,e,f,g,h;while(d=a.shift()){g={cb:b,ct:c,ev:d+":",id:this.counter},e=d.split(":"),h=this._cbs;while(f=e.shift())h.cbs.push(g),h=h.c[f]=h.c[f]||{cbs:[],c:{}}}++this.counter},this.off=this.unbind=function(a,b,c){var d,e=!0,f,g,h,i;a=a.split(/\s+/);while(e&&(i=a.shift())){d=i.split(":"),i+=":",e=this._cbs;while(g=d.shift()){f=[];while(h=e.cbs.shift())(b&&h.cb!=b||h.ev!=i||h.ct!=c)&&f.push(h);e.cbs=f,d.length?e=e.c[g]||null:delete e.c[g]}}},this.trigger=function(a){var b,c,d,e,f,g,h,i,j;j=a.split(/\s+/),c=arguments,f=[],i={};while(c[0]=b=j.shift()){d=b.split(":"),b+=":",e=this._cbs;while(e&&(g=d.shift())){for(h=0;h<e.cbs.length;++h)!i[e.cbs[h].id]&&b.lastIndexOf(e.cbs[h].ev,0)===0&&(f.push(e.cbs[h]),i[e.cbs[h].id]=1);e=e.c[g]||null}for(h=f.length-1;h>=0;--h)f[h].cb.apply(f[h].ct||this,c)}}}